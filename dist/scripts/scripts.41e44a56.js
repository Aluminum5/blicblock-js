(function(){"use strict";angular.module("blicblockApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","LocalStorageModule","angularMoment"]).config(["$routeProvider","localStorageServiceProvider",function(a,b){return b.setPrefix("blicblockJS"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}])}).call(this),function(){var a;a=function(){function a(a){this.color=a.color,this.x=a.x,this.y=a.y,this.locked=!1,this.active=!0,this.sliding=!1,this.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)})}return a}(),("undefined"!=typeof exports&&null!==exports?exports:this).Block=a}.call(this),function(){var a;a=function(){function a(a){this.blocks=[],this.index=a}return a.prototype.append=function(a){return this.blocks.push(a)},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).BlockRow=a}.call(this),function(){"use strict";angular.module("blicblockApp").directive("ngLeft",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){return b.which&&(37===b.which||"a"===String.fromCharCode(b.which))?(a.$apply(function(){return a.$eval(c.ngLeft)}),b.preventDefault()):void 0})}})}.call(this),function(){"use strict";angular.module("blicblockApp").directive("ngRight",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){return b.which&&(39===b.which||"d"===String.fromCharCode(b.which))?(a.$apply(function(){return a.$eval(c.ngRight)}),b.preventDefault()):void 0})}})}.call(this),function(){"use strict";angular.module("blicblockApp").directive("ngDown",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){return b.which&&(40===b.which||"s"===String.fromCharCode(b.which))?(a.$apply(function(){return a.$eval(c.ngDown)}),b.preventDefault()):void 0})}})}.call(this),function(){"use strict";angular.module("blicblockApp").directive("ngSpace",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){return b.which&&32===b.which?(a.$apply(function(){return a.$eval(c.ngSpace)}),b.preventDefault()):void 0})}})}.call(this),function(){"use strict";angular.module("blicblockApp").service("Tetromino",["$rootScope","$interval",function(a,b){var c;return new(c=function(){function a(){this.blocks=[],this.info={cols:5,rows:7,score_value:1e3,checking:!1,in_progress:!0,plumetting_block:!1,game_over:!1,current_score:0,tick_length_decrement_pct:.09,tick_length:1200,level:1}}return a.prototype.get_active_block=function(){return this.blocks.filter(function(a){return a.active})[0]},a.prototype.check_for_tetrominos=function(){var a,b,c,d;if(this.info.in_progress&&!this.info.checking){for(this.info.checking=!0,d=this.blocks,b=0,c=d.length;c>b;b++)a=d[b],a&&a.locked&&!a.active&&(this.check_for_straight_tetromino(a),this.check_for_square_tetromino(a),this.check_for_l_tetromino(a),this.check_for_z_tetromino(a),this.check_for_t_tetromino(a));return this.info.checking=!1}},a.prototype.get_closest_block_to_left=function(a,b){var c;return c=this.blocks.filter(function(c){return c.x===a&&c.y<b}),c.sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:0}),c[c.length-1]},a.prototype.get_closest_block_to_right=function(a,b){var c;return c=this.blocks.filter(function(c){return c.x===a&&c.y>b}),c.sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:0}),c[0]},a.prototype.get_closest_block_below=function(a,b){var c;return c=this.blocks.filter(function(c){return c.x>a&&c.y===b}),c.sort(function(a,b){return a.x<b.x?-1:a.x>b.x?1:0}),c[0]},a.prototype.is_block_directly_below=function(a,b){return this.blocks.filter(function(c){return c.x===a+1&&c.y===b})[0]},a.prototype.plummet_block=function(a,c,d){var e,f;return f=void 0,e=function(e){return function(){return e.info.plumetting_block=!0,a.x<c?a.x++:a.x===c&&(b.cancel(f),f=void 0,a.locked=!0,a.active=!1,e.info.plumetting_block=!1,e.on_block_land(a),d)?d():void 0}}(this),f=b(e,25)},a.prototype.blocks_on_top=function(a){var b,c,d,e,f;return e=function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.x);return e}(),f=function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.y);return e}(),c=Math.max.apply(Math,e),d=this.blocks.filter(function(a){return a.x<c&&f.indexOf(a.y)>-1}),d.sort(function(a,b){return a.x<b.x?1:a.x>b.x?-1:0}),d},a.prototype.drop_blocks=function(){var a,b,c,d,e,f;if(this.info.in_progress){for(e=this.blocks,f=[],c=0,d=e.length;d>c;c++)b=e[c],b&&!b.sliding&&(a=b.active||!b.locked,b.x===this.info.rows-1&&a&&(b.locked=!0,b.active=!1,this.on_block_land(b)),this.is_block_directly_below(b.x,b.y)&&a&&(b.locked=!0,b.active=!1,this.on_block_land(b)),b.locked||f.push(b.x++));return f}},a.prototype.on_block_land=function(){return this.check_for_tetrominos()},a.prototype.increment_level_if_necessary=function(){return this.info.current_score%4e3===0?this.info.level++:void 0},a.prototype.plummet_blocks=function(a,b){var c,d,e;return"undefined"==typeof b&&(b=0),c=a[b],d=this.get_closest_block_below(c.x,c.y),e=d?d.x-1:this.info.rows-1,this.plummet_block(c,e,function(c){return function(){return b<a.length-1?c.plummet_blocks(a,b+1):void 0}}(this))},a.prototype.remove_blocks=function(a){var b,c,d;if(this.info.in_progress){for(b=a.map(function(a){return a.id}),c=this.blocks.length-1;c>=0;)b.indexOf(this.blocks[c].id)>-1&&this.blocks.splice(c,1),c--;return this.info.current_score+=this.info.score_value,this.increment_level_if_necessary(),d=this.blocks_on_top(a),d.length>0&&this.plummet_blocks(d),this.check_for_tetrominos()}},a.prototype.lookup=function(a,b,c){return a>=this.info.rows||b>=this.info.cols?void 0:this.blocks.filter(function(d){return d.x===a&&d.y===b&&d.color===c})[0]},a.prototype.check_for_straight_tetromino=function(a){return this.check_for_straight_hor_tetromino(a),this.check_for_straight_ver_tetromino(a)},a.prototype.check_for_straight_hor_tetromino=function(a){var b,c,d,e,f,g;return g=a.y,f=a.x,e=a.color,b=this.lookup(f,g+1,e),b&&(c=this.lookup(f,g+2,e),c&&(d=this.lookup(f,g+3,e)))?this.remove_blocks([a,b,c,d]):void 0},a.prototype.check_for_straight_ver_tetromino=function(a){var b,c,d,e,f,g;return f=a.x,g=a.y,e=a.color,b=this.lookup(f+1,g,e),b&&(c=this.lookup(f+2,g,e),c&&(d=this.lookup(f+3,g,e)))?this.remove_blocks([a,b,c,d]):void 0},a.prototype.check_for_square_tetromino=function(a){var b,c,d,e,f,g;return f=a.x,g=a.y,e=a.color,b=this.lookup(f,g+1,e),b&&(c=this.lookup(f+1,g,e),c&&(d=this.lookup(f+1,g+1,e)))?this.remove_blocks([a,b,c,d]):void 0},a.prototype.check_for_l_tetromino=function(a){return this.check_for_left_l_tetromino(a),this.check_for_right_l_tetromino(a)},a.prototype.check_for_left_l_tetromino=function(a){var b,c,d,e,f,g;if(f=a.x,g=a.y,e=a.color,b=this.lookup(f+1,g,e)){if(c=this.lookup(f+2,g,e)){if(d=this.lookup(f+2,g-1,e))return this.remove_blocks([a,b,c,d]);if(d=this.lookup(f,g+1,e),!d)return;return this.remove_blocks([a,b,c,d])}if(c=this.lookup(f+1,g+1,e)){if(d=this.lookup(f+1,g+2,e),!d)return;return this.remove_blocks([a,b,c,d])}if((c=this.lookup(f,g-1,e))&&(d=this.lookup(f,g-2,e)))return this.remove_blocks([a,b,c,d])}},a.prototype.check_for_right_l_tetromino=function(a){var b,c,d,e,f,g;if(f=a.x,g=a.y,e=a.color,b=this.lookup(f+1,g,e)){if(c=this.lookup(f+2,g,e)){if(d=this.lookup(f+2,g+1,e))return this.remove_blocks([a,b,c,d]);if(d=this.lookup(f,g-1,e),!d)return;return this.remove_blocks([a,b,c,d])}if(c=this.lookup(f+1,g-1,e)){if(d=this.lookup(f+1,g-2,e),!d)return;return this.remove_blocks([a,b,c,d])}if((c=this.lookup(f,g+1,e))&&(d=this.lookup(f,g+2,e)))return this.remove_blocks([a,b,c,d])}},a.prototype.check_for_z_tetromino=function(a){var b,c,d,e,f,g;if(f=a.x,g=a.y,e=a.color,b=this.lookup(f+1,g,e)){if(c=this.lookup(f,g-1,e)){if(d=this.lookup(f+1,g+1,e),!d)return;return this.remove_blocks([a,b,c,d])}if(c=this.lookup(f,g+1,e)){if(d=this.lookup(f+1,g-1,e),!d)return;return this.remove_blocks([a,b,c,d])}if(c=this.lookup(f+1,g+1,e)){if(d=this.lookup(f+2,g+1,e),!d)return;return this.remove_blocks([a,b,c,d])}if((c=this.lookup(f+1,g-1,e))&&(d=this.lookup(f+2,g-1,e)))return this.remove_blocks([a,b,c,d])}},a.prototype.check_for_t_tetromino=function(a){var b,c,d,e,f,g;if(f=a.x,g=a.y,e=a.color,b=this.lookup(f+1,g,e)){if(c=this.lookup(f+2,g,e)){if(d=this.lookup(f+1,g+1,e))return this.remove_blocks([a,b,c,d]);if(d=this.lookup(f+1,g-1,e),!d)return;return this.remove_blocks([a,b,c,d])}if(c=this.lookup(f+1,g-1,e)){if(d=this.lookup(f+1,g+1,e),!d)return;return this.remove_blocks([a,b,c,d])}if((c=this.lookup(f,g-1,e))&&(d=this.lookup(f,g+1,e)))return this.remove_blocks([a,b,c,d])}},a}())}])}.call(this),function(){"use strict";angular.module("blicblockApp").controller("MainCtrl",["$scope","$window","$interval","localStorageService","Tetromino",function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;return a.blocks=e.blocks,a.upcoming=[],a.game_info=e.info,a.new_high_score={},j=void 0,g=["magenta","yellow","blue","green","white","orange"],o="high_score",n=function(){var a;return a=d.get(o),a?a:{}},a.existing_high_score=n(),m=function(){return g[Math.floor(Math.random()*g.length)]},f=function(){return angular.isDefined(j)?(c.cancel(j),j=void 0):void 0},q=function(){var b,c;return c=d.get(o),b=a.game_info.current_score,c&&c.value<b||!c?(c={value:b,date:new Date},d.set(o,c),a.new_high_score.value=c.value):void 0},l=function(){return a.game_info.in_progress=!1,a.game_info.game_over=!0,f(),q()},p=function(){return a.upcoming[1]=new Block({color:m()})},h=function(){var b,c;if(!a.game_info.checking)return c=a.blocks.filter(function(a){return 0===a.x&&2===a.y}),c.length>0?void l():(b=a.upcoming[0],b.x=0,b.y=2,a.upcoming[0]=a.upcoming[1],p(),a.blocks.push(b))},i=function(){var a;return(a=e.get_active_block())?void 0:h()},k=function(){return a.game_info.in_progress&&!a.game_info.plumetting_block?(e.drop_blocks(),i()):void 0},r=function(){return angular.isDefined(j)?void 0:j=c(k,a.game_info.tick_length)},a.upcoming.push(new Block({color:m()})),a.upcoming.push(new Block({color:m()})),a.$on("pause",function(){return a.game_info.in_progress=!1,f()}),a.$on("resume",function(){return a.game_info.in_progress=!0,r()}),a.$on("toggle_pause",function(){return a.game_info.in_progress?a.$emit("pause"):a.game_info.game_over?void 0:a.$emit("resume")}),a.$on("move_left",function(){var b,c;if(a.game_info.in_progress&&(b=e.get_active_block(),b&&0!==b.y))return b.sliding=!0,c=e.get_closest_block_to_left(b.x,b.y),c?b.y=c.y+1:b.y--,b.sliding=!1}),a.$on("move_right",function(){var b,c;if(a.game_info.in_progress&&(b=e.get_active_block(),b&&b.y!==a.game_info.cols-1))return b.sliding=!0,c=e.get_closest_block_to_right(b.x,b.y),c?b.y=c.y-1:b.y++,b.sliding=!1}),a.$on("move_down",function(){var b,c,d;if(a.game_info.in_progress&&(b=e.get_active_block(),b&&b.x!==a.game_info.rows-1))return c=e.get_closest_block_below(b.x,b.y),d=c?c.x-1:a.game_info.rows-1,e.plummet_block(b,d,function(){return f(),h(),r()})}),a.$watch("game_info.level",function(){return a.game_info.level>1&&(a.game_info.tick_length-=a.game_info.tick_length*a.game_info.tick_length_decrement_pct,f()),r()}),a.new_game=function(){return b.location.reload()},a.$on("$locationChangeStart",function(){return a.$emit("pause")})}])}.call(this),function(){"use strict";angular.module("blicblockApp").controller("HowToPlayModalCtrl",["$rootScope","$scope","$modal",function(a,b,c){return b.open=function(){var b,d,e;return a.$broadcast("pause"),b=c.open({templateUrl:"how-to-play-modal-content.html",controller:"HowToPlayModalInstanceCtrl"}),e=function(){return a.$broadcast("resume")},d=e,b.result.then(e,d)}}])}.call(this),function(){"use strict";angular.module("blicblockApp").controller("HowToPlayModalInstanceCtrl",["$scope","$modalInstance",function(a,b){return a.ok=function(){return b.close()},a.cancel=function(){return b.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("blicblockApp").controller("AboutCtrl",["$scope",function(){}])}.call(this);